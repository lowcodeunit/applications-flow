<app-host-dashboard-card-element
  class="projects section"
  [context]="{ Title: 'Projects', Icon: 'language' }"
  *ngIf="State"
>
  <nav>
    <a
      href="/docs/getting-started/projects"
      target="_blank"
      lcuEvent="click"
      label="Projects"
      category="help"
    >
      <mat-icon matTooltip="More info">help_outline</mat-icon>
    </a>
  </nav>

  <ng-container *ngIf="!State?.Loading">
    <div fxLayout="row" fxLayout.lt-md="column" fxLayoutAlign="center center">
      <div class="margin-x-1" fxFlex="40%" fxFlex.lt-md="100%">
        <div class="welcome">
          <h2 class="mat-display-2">
            <span *ngIf="State.Projects?.length <= 0">
              Thank you for signing up
            </span>

            <span *ngIf="State.Projects?.length > 0">Project Setup</span>
          </h2>

          <h3 class="mat-headline">Let's get your Project setup and running</h3>
        </div>
      </div>

      <div
        class="divider-fill-vert margin-x-5"
        fxShow
        [fxHide.lt-md]="true"
      ></div>

      <div
        class="divider-fill-hor margin-y-5"
        fxHide
        [fxShow.lt-md]="true"
      ></div>

      <div class="setup margin-x-1" fxFlex="60%" fxFlex.lt-md="100%">
        <form
          [formGroup]="ProjectFormGroup"
          (ngSubmit)="CreateProvider($event)"
        >
          <mat-horizontal-stepper linear #providerStepper>
            <mat-step
              label="Connect Git Provider"
              [completed]="State.GitHub.HasConnection"
            >
              <div class="connect margin-3">
                <h4 class="mat-title">
                  The first step is getting your git provider connected
                </h4>

                <!-- href="/.oauth/github" -->
                <a
                  (click)="TempGitHubConnect()"
                  mat-raised-button
                  color="primary"
                  class="github"
                >
                  Connect with GitHub

                  <span class="octocat-icon"></span>
                </a>
              </div>
            </mat-step>

            <mat-step
              label="Setup Repository"
              formGroupName="repoDetails"
              [completed]="
                IsOrganizationValid && IsRepositoryValid && IsBranchValid
              "
            >
              <div *ngIf="!State.GitHub.Loading">
                <h4 class="mat-title">Now we'll setup your repository</h4>

                <mat-form-field class="mat-full-width margin-2">
                  <mat-select
                    formControlName="organization"
                    placeholder="Organization"
                    (selectionChange)="OrganizationChanged($event)"
                    required
                  >
                    <mat-option value="Org1">Org1</mat-option>
                    <mat-option value="Org2">Org2</mat-option>
                  </mat-select>

                  <mat-icon matSuffix (click)="RefreshOrganizations()">
                    refresh
                  </mat-icon>

                  <mat-hint>
                    If you don't have an organization or would like to create a
                    new one,
                    <a
                      href="https://github.com/account/organizations/new"
                      target="_blank"
                    >
                      start here
                    </a>
                    .
                  </mat-hint>
                </mat-form-field>

                <mat-form-field class="mat-full-width margin-2">
                  <mat-select
                    formControlName="repository"
                    [placeholder]="
                      IsOrganizationValid
                        ? 'Repository'
                        : 'Repository (select organization first)'
                    "
                    [disabled]="!IsOrganizationValid"
                    required
                    (selectionChange)="RepositoryChanged($event)"
                    *ngIf="!State.GitHub.CreatingRepository"
                  >
                    <mat-option value="Repo1">Repo1</mat-option>
                    <mat-option value="Repo2">Repo2</mat-option>
                  </mat-select>

                  <input
                    matInput
                    placeholder="Repository (creates new if does not exist)"
                    formControlName="repository"
                    required
                    *ngIf="State.GitHub.CreatingRepository"
                  />

                  <mat-icon
                    matSuffix
                    (click)="CreateRepository()"
                    *ngIf="!State.GitHub.CreatingRepository && IsOrganizationValid"
                  >
                    add_circle
                  </mat-icon>

                  <mat-icon
                    matSuffix
                    color="primary"
                    (click)="SaveRepository()"
                    *ngIf="State.GitHub.CreatingRepository && IsRepositoryValid"
                  >
                    save
                  </mat-icon>

                  <mat-icon
                    matSuffix
                    (click)="CancelCreateRepository()"
                    *ngIf="State.GitHub.CreatingRepository"
                  >
                    cancel
                  </mat-icon>
                </mat-form-field>

                <mat-form-field class="mat-full-width margin-2">
                  <mat-select
                    formControlName="branch"
                    [placeholder]="
                      IsRepositoryValid
                        ? 'Branch'
                        : 'Branch (select repository first)'
                    "
                    [disabled]="
                      !IsRepositoryValid || State.GitHub.CreatingRepository
                    "
                    required
                  >
                    <mat-option value="master">master</mat-option>
                  </mat-select>
                </mat-form-field>

                <div>
                  <button mat-button matStepperPrevious type="button">
                    Back
                  </button>

                  <div fxFlex></div>

                  <button
                    mat-raised-button
                    color="accent"
                    matStepperNext
                    type="button"
                    [disabled]="State.GitHub.CreatingRepository"
                  >
                    Next
                  </button>
                </div>
              </div>

              <div *ngIf="State.GitHub.Loading">
                <h4 class="mat-title">Reloading Organizations</h4>

                <lcu-loader [loading]="true"></lcu-loader>
              </div>
            </mat-step>

            <!-- [stepControl]="formArray.get([2])" -->
            <mat-step label="Configure Details" formGroupName="projectDetails">
              <h4 class="mat-title">Configure the basic project details for</h4>

              <h4 class="mat-title">
                <strong>
                  @{{
                    ProjectFormGroup.get("repoDetails").get("organization")
                      .value
                  }}/{{
                    ProjectFormGroup.get("repoDetails").get("repository").value
                  }}
                </strong>
              </h4>

              <mat-form-field class="mat-full-width margin-2">
                <mat-select
                  formControlName="templateType"
                  placeholder="Template Type"
                  required
                >
                  <mat-option value="LowCodeUnit">Low Code Unit</mat-option>

                  <mat-option value="custom">Custom</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field class="mat-full-width margin-2">
                <mat-select
                  formControlName="template"
                  [placeholder]="
                    IsTemplateTypeValid
                      ? 'Template'
                      : 'Template (select template type first)'
                  "
                  [disabled]="!IsTemplateTypeValid"
                  required
                  *ngIf="
                    ProjectFormGroup.get('projectDetails').get('templateType')
                      .value != 'custom'
                  "
                >
                  <mat-option value="Docusaurus">Docusaurus</mat-option>

                  <mat-option value="LCUPack">LCU Pack</mat-option>
                </mat-select>

                <input
                  matInput
                  placeholder="Template"
                  formControlName="template"
                  required
                />
              </mat-form-field>

              <div>
                <button mat-button matStepperPrevious type="button">
                  Back
                </button>

                <div fxFlex></div>

                <button
                  mat-raised-button
                  color="primary"
                  [disabled]="!IsTemplateValid"
                >
                  Create Project
                </button>
              </div>
            </mat-step>
          </mat-horizontal-stepper>
        </form>
      </div>
    </div>
  </ng-container>

  <div class="loading" *ngIf="State?.Loading">
    <lcu-loader [loading]="State?.Loading"></lcu-loader>

    <div class="margin-3">
      <p *ngIf="!State.UserEnterpriseLookup">Loading your projects</p>

      <p *ngIf="State.UserEnterpriseLookup">Loading your Dashboard.</p>
    </div>
  </div>
</app-host-dashboard-card-element>
