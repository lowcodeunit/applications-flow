<app-host-dashboard-card-element
  class="projects section"
  [context]="{ Title: 'Projects', Icon: 'language' }"
>
  <nav>
    <a
      href="/docs/getting-started/projects"
      target="_blank"
      lcuEvent="click"
      label="Projects"
      category="help"
    >
      <mat-icon matTooltip="More info">help_outline</mat-icon>
    </a>
  </nav>

  <ng-container *ngIf="State">
    <!-- <lcu-projects-header></lcu-projects-header> -->
    <div 
    fxLayout="row" 
    fxLayout.lt-sm="column"
    class="container">

    <!-- Projects -->
    <div 
        id="projects"
        fxLayout="column"
        fxFlex.gt-xs="60"
        class="projects padding-3"
        [ngClass.lt-sm]="'margin-bottom-2'"
        [ngClass.gt-xs]="'margin-right-2'"
    >
    <div 
        fxLayout="row"
        fxLayoutAlign="start center"
        class="title margin-bottom-4">
        <mat-icon class="margin-right-2">language</mat-icon>
        <span>Projects</span>
    </div>
        <lcu-project-items *ngIf="State" [projects]="State.Projects"></lcu-project-items>
    </div>
    <div
        class="divider-fill-vert"
        [fxHide.lt-md]="true">
    </div>
    <!-- Builds -->
    <div 
        id="builds"
        fxFlex.gt-xs="20"
        fxLayout="column"
        class="builds padding-3"
        [ngClass.lt-sm]="'margin-bottom-2'"
        [ngClass.gt-xs]="'margin-right-2'"
    >
        <div 
            fxLayout="row"
            fxLayoutAlign="start center"
            class="title margin-bottom-4">
            <mat-icon class="margin-right-2">gavel</mat-icon>
            <span>Builds</span>
        </div>
        <lcu-builds 
          *ngIf="State" 
          (deploy-run)="DeployRun($event)">
        </lcu-builds>
    </div>

    <div
      class="divider-fill-vert"
      fxShow
      [fxHide.lt-md]="true">
    </div> 

    <!-- Recent Activities -->
    <div 
        id="recent"
        fxLayout="column"
        fxFlex.gt-xs="20"
        class="recent-activities padding-3">
        <div 
            fxLayout="row"
            fxLayoutAlign="start center"
            class="title margin-bottom-4">
            <mat-icon class="margin-right-2">list</mat-icon>
            <span>Recent Activities</span>
        </div>
    </div>
</div>


  <div
    class="divider-fill-hor margin-top-4 margin-bottom-4"
    [fxShow.lt-md]="true">
  </div>

    <lcu-project-tabs></lcu-project-tabs>
  </ng-container>

  <ng-container *ngIf="!State?.Loading">
    <div *ngIf="CreatingProject">
      <lcu-create-project-wizard></lcu-create-project-wizard>
    </div>

    <div *ngIf="EditingProjectSettings">
      <lcu-project-settings
        [project]="EditingProjectSettings"
        [host-dns-instance]="State.HostDNSInstance"
        (saved)="SaveProject($event)"
        (cancelled)="SetEditProjectSettings(null)"
      ></lcu-project-settings>
    </div>

    <ng-container *ngIf="!CreatingProject && !EditingProjectSettings">
      <div>
        <div fxLayout="row" *ngFor="let project of State.Projects">
          <!-- <div fxFlex="150px" class="project-image">
            <img [src]="project.Image" *ngIf="project.Image" />
          </div> -->

          <div class="margin-3">
            <!-- <h3 class="mat-headline">
              {{ project.Name }}

              <a
                mat-icon-button
                (click)="SetEditProjectSettings(project)"
                target="_blank"
                title="Edit Project Settings"
              >
                <mat-icon>settings</mat-icon>
              </a>

              <a
                mat-icon-button
                href="https://{{ project.Host }}"
                target="_blank"
                [title]="project.Host"
                color="accent"
              >
                <mat-icon>launch</mat-icon>
              </a>
            </h3> -->

            <ng-container *ngIf="project.Runs?.length <= 0">
              <div *ngIf="project.LCUs?.length <= 0">
                Need to handle case when no LCUs, allow create again.. most
                likely caused by error state
              </div>

              <ng-container *ngIf="project.LCUs?.length > 0">
                <ng-container
                  *ngIf="HasDevOpsConfigured(project, project.LCUs[0].ID)"
                >
                  No workflow runs completed, check in code
                  <a
                    href="https://github.com/{{
                      project.LCUs[0].Organization
                    }}/{{ project.LCUs[0].Repository }}/actions"
                    target="_blank"
                  >
                    here
                  </a>
                  to the {{ project.LCUs[0].Branch }} to start a build with
                  GitHub Actions.
                </ng-container>

                <div *ngIf="!HasDevOpsConfigured(project, project.LCUs[0].ID)">
                  The GitHub Actions are not setup for this project, please
                  reconfigure.

                  <div class="margin-2">
                    <a
                      mat-raised-button
                      color="primary"
                      (click)="
                        ConfigureGitHubLCUDevOps(project.ID, project.LCUs[0])
                      "
                    >
                      Configure Build and Deploy
                    </a>
                  </div>
                </div>
              </ng-container>
            </ng-container>

            <!-- <ng-container *ngIf="project.Runs?.length > 0">
              <ng-container *ngIf="project.Runs[0]; let latestRun">
                <h4
                  class="mat-subheading-2"
                  *ngIf="RetrieveLCU(project, latestRun.LCUID); let lcu"
                >
                  Built with GitHub Actions

                  <a
                    mat-icon-button
                    class="workflow-run-status"
                    href="https://github.com/{{ lcu.Organization }}/{{
                      lcu.Repository
                    }}/actions"
                    target="_blank"
                  >
                    <mat-icon
                      color="primary"
                      *ngIf="latestRun.Conclusion == 'success'"
                    >
                      check_circle
                    </mat-icon>

                    <mat-icon
                      color="warn"
                      *ngIf="latestRun.Conclusion == 'failure'"
                    >
                      error_outline
                    </mat-icon>
              
                    {{ latestRun.Status }}

                    {{ latestRun.Conclusion }}
                  </a>
                </h4>

                <h4 class="mat-subheading-1">
                  <a mat-button (click)="DeployRun(latestRun)">
                    Deploy Latest
                  </a>
                </h4>
              </ng-container>
            </ng-container> -->
          </div>
        </div>
      </div>

      <span class="card-actions">
        <div fxFlex></div>

        <button
          mat-raised-button
          color="accent"
          (click)="ToggleCreateProject()"
        >
          Create Project
        </button>
      </span>
    </ng-container>
  </ng-container>

  <div class="loading" *ngIf="State?.Loading">
    <lcu-loader [loading]="State?.Loading"></lcu-loader>

    <div class="margin-3">
      <p *ngIf="!State.UserEnterpriseLookup">Loading your projects</p>

      <p *ngIf="State.UserEnterpriseLookup">Loading your Dashboard.</p>
    </div>
  </div>
</app-host-dashboard-card-element>
